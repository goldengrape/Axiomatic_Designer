好的，遵照指示。

我将根据《项目代办事项列表 (V2.1)》中的顺序，开始执行下一项工作：**撰写《L1-DP6 评审引擎测试大纲》**。

这份文档将定义一套标准的、可执行的测试用例，旨在验证任何 `L1-DP6: 评审与评估引擎` 的具体实现是否严格遵循其 API 规范、功能需求和核心业务逻辑。测试的重点将放在契约遵从性、对审查清单和公理设计原则的正确应用，以及对核心工作流（特别是仲裁流程）的驱动能力上。

以下是本次工作的产出文档。

---

### **L1-DP6 评审引擎测试大纲 (V1.0)**

**状态:** 草稿

**版本说明:** 本文档 (V1.0) 是该测试大纲的初版。其目的是为 `L1-DP6: 评审与评估引擎` 的实现提供一套全面的功能验证测试用例。

#### **1. 引言**

本文档定义了一套标准的测试用例和验收标准，旨在验证 `L1-DP6: 评审与评估引擎` 的具体实现是否完全符合其定义的契约和功能需求。`L1-DP6` 是系统中负责保证文档质量和设计原则合规性的核心组件，因此对其行为的严格验证至关重要。

**测试目标:**
*   **契约遵从性:** 确保服务的实现严格遵循《L1-DP6 评审与评估引擎 API 接口规范 (V1.1)》中定义的异步模式、数据模型和错误处理机制。
*   **功能正确性:** 验证引擎是否能正确应用项目模板中定义的审查清单、执行可追溯性检查、分析设计矩阵，并依据公理设计原则进行评估。
*   **工作流驱动能力:** 验证引擎是否能在预设条件下（如达到最大审查次数）正确地触发“用户仲裁”流程，生成包含 `ARBITRATION_REQUIRED` 决策的响应。

**测试哲学:** 本大纲遵循 **黑盒功能测试** 的原则。测试将通过调用 API 端点来验证服务的外部行为，而 **不** 关心其内部实现细节，如具体的 LLM Prompt 工程或其依赖的库。测试的核心是验证“服务做了什么”，而非“服务如何做”。

**设计依据:**
*   《L1-DP6 评审与评估引擎 API 接口规范 (V1.1)》 (核心测试对象)
*   《软件用户需求文档 (URD) V1.6》 (特别是 §2.1, §4.2, §4.3, §6.3)
*   《公理设计辅助系统 L1 公理设计文档 (V1.1)》
*   《项目模板 Schema 规范 (V1.2)》
*   《项目代办事项列表 (V2.1)》

#### **2. 测试范围**

##### **2.1. 范围之内 (In Scope)**
*   API 异步工作流的完整验证（`POST` 返回 202 -> `GET` 轮询 -> `GET` 返回最终结果）。
*   对 `ReviewRequest` 和 `ReviewResponse` 数据模型的严格验证。
*   对所有评审决策 (`APPROVED`, `REVISION_REQUESTED`, `ARBITRATION_REQUIRED`) 的逻辑验证。
*   对项目模板中 `reviewChecklist` 的应用情况验证，包括对特殊指令（如 `[TraceabilityCheck]`）的处理。
*   对公理一 (`[Axiom1-Check]`) 的评估能力验证。
*   对用户仲裁触发条件（特别是 `MAX_CYCLES_REACHED`）的验证。

##### **2.2. 范围之外 (Out of Scope)**
*   **性能测试:** 不包括负载、压力或延迟测试。
*   **评审质量的主观评估:** 不评估 LLM 生成的 `executive_summary` 或 `findings` 的“智能程度”或“洞察力”。测试只关心这些字段是否按要求生成且结构正确。
*   **安全测试:** 认证、授权等安全相关的测试由更高层次的系统测试负责。
*   **具体实现的内部逻辑:** 不测试服务实现的内部代码、算法或依赖项。

#### **3. 测试环境与前提**

*   **测试客户端:** 一个能够构造并发送 HTTP 请求，并能解析 JSON 响应的自动化测试框架。
*   **被测服务 (SUT):** 一个正在运行的 `L1-DP6` 服务实例。
*   **模拟依赖服务 (Mock Services):** **至关重要。** 由于 `L1-DP6` 依赖多个其他L1服务来获取上下文，测试环境必须提供以下服务的 **模拟实现**，以便返回可预测的、受控的测试数据：
    *   **Mock L1-DP1 (模板服务):** 用于提供包含特定审查清单和配置（如 `maxReviewCycles`）的测试模板。
    *   **Mock L1-DP2 (词汇服务):** 用于提供测试用的词汇表。
    *   **Mock L1-DP7 (版本控制服务):** 用于根据 `document_uri` 提供受控的文档内容（如完美的草稿、有缺陷的草稿等）。
*   **测试数据集:** 一套预先定义好的文档草稿、上游文档、项目模板和词汇文件，专门用于触发特定的测试场景。

#### **4. 测试用例**

##### **4.1. 核心逻辑与成功路径测试**

| 用例ID | 测试描述 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **TC-DP6-01** | **完美草稿-批准路径:** 评审一份完全符合所有标准和清单的文档草稿。 | 1. 准备一份“完美”的文档草稿。 <br> 2. 构造 `ReviewRequest` 指向该草稿。 <br> 3. `POST` 请求，轮询 `GET` 直至完成。 | 1. 最终响应的 `overall_decision` 字段为 `"APPROVED"`。 <br> 2. `findings` 数组为空。 <br> 3. `checklist_responses` 数组中所有项的 `status` 均为 `"PASSED"`。 |
| **TC-DP6-02** | **有缺陷草稿-修订路径:** 评审一份包含明显、简单缺陷的文档草稿。 | 1. 准备一份有拼写错误和术语不一致的草稿。 <br> 2. 构造 `ReviewRequest`。 <br> 3. `POST` 请求，轮询 `GET` 直至完成。 | 1. 最终响应的 `overall_decision` 字段为 `"REVISION_REQUESTED"`。 <br> 2. `findings` 数组不为空，且包含描述拼写和术语问题的条目。 <br> 3. `checklist_responses` 中对应项的 `status` 为 `"FAILED"`。 |

##### **4.2. 公理设计与特殊指令测试**

| 用例ID | 测试描述 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **TC-DP6-03** | **可追溯性检查 (`[TraceabilityCheck]`):** 评审一份L2设计文档，其某个FR无法追溯到L1父文档。 | 1. 在测试模板中加入 `"[TraceabilityCheck]..."` 指令。 <br> 2. 准备一份L2草稿，其中一个L2-FR故意无法映射回L1-FR。 <br> 3. 构造 `ReviewRequest`，并在 `upstream_documents` 中提供L1父文档。 | 1. `overall_decision` 为 `"REVISION_REQUESTED"`。 <br> 2. `checklist_responses` 中 `[TraceabilityCheck]` 项的 `status` 为 `"FAILED"`。 <br> 3. `findings` 数组中包含一个 `severity` 为 `MAJOR` 或 `CRITICAL` 的发现项，明确指出追溯性失败。 |
| **TC-DP6-04** | **独立公理检查 (`[Axiom1-Check]`):** 评审一份包含耦合设计矩阵的设计文档。 | 1. 在测试模板中加入 `"[Axiom1-Check]..."` 指令。 <br> 2. 准备一份带有非对角线设计矩阵的草稿。 <br> 3. 构造 `ReviewRequest`。 | 1. `overall_decision` 为 `"REVISION_REQUESTED"`。 <br> 2. `checklist_responses` 中 `[Axiom1-Check]` 项的 `status` 为 `"FAILED"`。 <br> 3. `findings` 数组中包含一个 `severity` 为 `CRITICAL` 的发现项，其 `description` 明确指出“违反独立公理”，且 `location` 精确定位到该设计矩阵。 |

##### **4.3. 工作流与仲裁触发测试**

| 用例ID | 测试描述 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **TC-DP6-05** | **仲裁触发 (`MAX_CYCLES_REACHED`):** 模拟多次修订后仍未批准，触发用户仲裁。 | 1. 在 Mock L1-DP1 提供的项目模板中，将 `maxReviewCycles` 设置为 `3`。 <br> 2. 模拟第一次评审（同TC-DP6-02）。 <br> 3. 模拟第二次评审（假设修订后仍有缺陷）。 <br> 4. 发起第三次评审请求。 | 1. 针对第三次请求的最终响应，其 `overall_decision` 字段**必须**为 `"ARBITRATION_REQUIRED"`。 <br> 2. `decision_reason` 对象**必须**存在，且其 `code` 字段为 `"MAX_CYCLES_REACHED"`。 |

##### **4.4. API 契约与健壮性测试**

| 用例ID | 测试描述 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **TC-DP6-06** | **异步流程验证:** 验证 API 的基本异步调用流程。 | 1. `POST /api/v1/reviews`，使用任意有效请求体。 | 1. 服务立即返回 HTTP `202 Accepted` 状态码。 <br> 2. 响应头包含一个有效的 `Location` 字段。 <br> 3. 响应体是一个 `status` 为 `PENDING` 的 `ReviewStatus` 对象。 |
| **TC-DP6-07** | **轮询状态验证:** 验证轮询任务状态的正确性。 | 1. 执行 TC-DP6-06。 <br> 2. 立即 `GET` `Location` 头返回的 URL。 | 1. 服务返回 HTTP `200 OK` 状态码。 <br> 2. 响应体是一个 `ReviewStatus` 对象，其 `status` 为 `PENDING` 或 `RUNNING`。 |
| **TC-DP6-08** | **无效请求-缺少字段:** 发送一个缺少 `document_uri` 的请求。 | 1. 构造一个不含 `document_uri` 键的 `ReviewRequest` 对象。 <br> 2. `POST` 到 `/api/v1/reviews`。 | 1. 服务返回 HTTP `400 Bad Request` 状态码。 <br> 2. 响应体是一个标准的 `Error` 对象。 |
| **TC-DP6-09** | **无效请求-URI无法解析:** 请求中引用的 `document_uri` 在 Mock L1-DP7 中不存在。 | 1. 构造一个 `document_uri` 为 `vcs://.../non-existent-doc.md` 的请求。 <br> 2. `POST` 到 `/api/v1/reviews`。 | 1. 服务返回 HTTP `404 Not Found` 状态码。 <br> 2. 响应体是一个标准的 `Error` 对象，消息指出无法找到引用的资源。 |

#### **5. 通过标准**

*   所有定义的测试用例都必须被成功执行。
*   每个测试用例的实际结果必须与“预期结果”列中描述的所有条件完全匹配。
*   任何偏离预期的行为都将被视为测试失败，相关的服务实现必须在被系统集成前修复其缺陷。

---
Gemini 2.5 Pro 0605 writer