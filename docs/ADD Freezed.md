
---

### **公理设计辅助系统 L1 公理设计文档 (V1.1)**

**状态:** 批准 (Approved)

**版本说明:** 本文档 (V1.1) 是对 V1.0 版本的重大修订，旨在响应并解决《评审意见报告：关于<公理设计辅助系统 L1 公理设计文档 (V1.0)>》中指出的根本性设计缺陷。本次修订的核心目标是：通过重构功能需求 (FRs) 和设计参数 (DPs) 的定义，消除原设计中违反独立公理的强耦合，建立一个职责清晰、功能独立的L1架构。

#### **1. 引言**

本文档是“公理设计辅助系统”本身的 L1 级公理设计文档。它系统地定义了顶层功能需求 (FRs) 和相应的设计参数 (DPs)，并对其对公理设计两大核心公理——独立公理 (Axiom 1) 和信息公理 (Axiom 2) 的遵循情况进行了分析。

本文档基于《软件用户需求文档 (URD) V1.6》中的用户需求 (URs)、功能描述和约束起草。设计过程遵循公理设计“之字形 (zig-zagging)”方法论，此 L1 设计作为整个分解过程的起点。

**文档范围：**
本文档在最高层级定义了公理设计辅助系统的关键功能和核心设计组件。具体包括：
*   系统 L1 级功能需求 (FRs) 集合。
*   满足 L1 FRs 的 L1 级设计参数 (DPs) 集合。
*   L1 FRs 与 L1 DPs 之间的映射矩阵及其分析。
*   L1 设计对公理一 (Axiom 1) 遵循情况的评估。
*   评估 L1 设计备选方案（公理二 Axiom 2）的框架。
*   后续设计分解步骤的规划。

#### **2. 系统级功能需求 (L1 FRs)**

基于 URD V1.6，我们提炼并定义了以下系统 L1 级功能需求。与V1.0相比，此版本对FR进行了根本性重构，将原先的功能集合（旧FR1）和过程描述（旧FR6）分解或消除，以确保每个FR都是一个原子的、独立的功能定义。

*   **FR1: 管理项目配置模板**
    *   定义：系统应提供创建、保存和应用项目模板的能力。模板可预设审查轮数、LLM角色的行为风格、文档结构、审查清单以及信息公理的量化评估指标。
    *   URD 来源：3.3 (FR-SYS-10)
    *   可追溯 UR：UR-6

*   **FR2: 管理项目级词汇与约束**
    *   定义：系统应维护一个全局性的“项目词汇与约束”文件，包括术语定义、缩写词、命名约定和格式化约束，并在所有文档生成和审查过程中强制应用这些规则。
    *   URD 来源：5.2 (FR-SYS-06)
    *   可追溯 UR：UR-8

*   **FR3: 从外部知识源检索信息**
    *   定义：系统应能根据当前任务上下文，通过一个抽象的知识库服务接口，从项目专属知识库中智能检索相关信息片段。
    *   URD 来源：1.4 (C-2), 5.1 (FR-SYS-04, FR-SYS-05)
    *   可追溯 UR：UR-7

*   **FR4: 应用知识源优先级规则**
    *   定义：当从不同来源获取的信息（如“项目词汇与约束”和“外部知识库”）发生冲突时，系统必须遵循一个预定义的优先级规则（词汇与约束 > 外部知识库）来解决冲突。
    *   URD 来源：5.3 (FR-SYS-31)
    *   可追溯 UR：UR-8

*   **FR5: 起草与修订文档内容**
    *   定义：系统应能基于输入（如上游文档、知识片段等）生成各类文档的草稿，并能根据指令（如审查意见、用户批注）修订内容。此功能包括生成文本图表代码和结构化内容（如FR-DP映射表）。
    *   URD 来源：1.3 (FR-SYS-01, C-1), 2.2 (FR-SYS-14), 2.3 (FR-SYS-15, FR-SYS-17), 2.5 (FR-SYS-25), 6.2 (FR-SYS-20), 6.3 (FR-SYS-21), 6.4 (FR-SYS-23), 7.2 (FR-SYS-02, C-16), 7.3 (FR-SYS-13)
    *   可追溯 UR：UR-1, UR-2, UR-9

*   **FR6: 评审与评估文档内容**
    *   定义：系统应能对照标准（如审查清单、上游文档、项目词汇）自动评审文档草稿，并生成结构化意见。评审需关注一致性、可追溯性以及对公理设计的应用评估。
    *   URD 来源：2.1 (Reviewer role), 2.3 (FR-SYS-16), 2.4 (FR-SYS-16), 4.2 (FR-SYS-12), 5.3 (FR-SYS-32), 6.3 (FR-SYS-22), 6.4 (FR-SYS-24, C-10, C-11, C-13)
    *   可追溯 UR：UR-1, UR-8, UR-10

*   **FR7: 管理文档版本与变更**
    *   定义：系统应通过与Git集成来管理文档的版本和状态。必须实现一个结构化的变更管理流程，用于处理对已冻结文档的修改，包括依赖分析、生成《变更影响报告》并记录用户决策。
    *   URD 来源：2.1 (Automated System Agent, C-3), 2.4 (FR-SYS-28, C-5; FR-SYS-29, C-6; FR-SYS-30), 3.2 (FR-SYS-08, C-7, C-8, C-9), 7.1 (FR-SYS-03)
    *   可追溯 UR：UR-3, UR-11, UR-12

*   **FR8: 处理用户交互与决策**
    *   定义：系统应能接收、解析并响应用户的命令和决策，包括流程控制（暂停/恢复）、用户仲裁、最终批准以及对内容的即时反馈批注。
    *   URD 来源：3.1 (FR-SYS-07), 4.3 (FR-SYS-09, FR-SYS-33, C-14), 7.3 (FR-SYS-13, C-17), 2.3 (User review), 2.4 (User review), 2.5 (FR-SYS-26)
    *   可追溯 UR：UR-4, UR-5, UR-9

#### **3. 系统级设计参数 (L1 DPs)**

为了满足上述重构后的L1 FRs，我们定义了以下L1级设计参数。此处的DPs与FRs一一对应，以实现功能独立。此外，引入了一个特殊的架构组件DP0，它不直接实现任何FR，而是作为协调器来组织其他DPs的执行流程。

*   **DP0: 工作流与状态控制器 (Workflow & State Controller)**
    *   职责：这是一个**纯粹的架构协调组件，没有对应的FR**。其唯一职责是根据系统预设的流程模型（如“撰写-审查-修订”循环），管理系统状态，并按顺序**调用**其他DPs的服务（DP5, DP6, DP7, DP8）来推进工作流。它通过清晰的接口与其它DPs交互，是解耦后系统流程控制的实现。
    *   **不实现任何FR**，但协调DP5, DP6, DP7, DP8去满足各自的FR。

*   **DP1: 项目模板管理器 (Project Template Manager)**
    *   职责：负责处理项目模板的CRUD（创建、读取、更新、删除）操作。它为系统的其他部分提供按需加载的配置数据。
    *   主要实现 L1 FRs：FR1。

*   **DP2: 项目词汇服务 (Project Lexicon Service)**
    *   职责：负责加载、存储和提供对“项目词汇与约束”文件内容的访问接口。它确保项目范围内的术语和规则的一致性应用。
    *   主要实现 L1 FRs：FR2。

*   **DP3: 知识检索服务 (Knowledge Retrieval Service)**
    *   职责：封装了与抽象知识库服务接口的交互。它接收检索请求，并返回相关的信息片段。
    *   主要实现 L1 FRs：FR3。

*   **DP4: 知识仲裁器 (Knowledge Arbiter)**
    *   职责：实现一个简单的逻辑模块，当接收到来自不同源的冲突信息时（例如，来自DP2和DP3的数据），应用预定义的优先级规则并输出最终采纳的信息。
    *   主要实现 L1 FRs：FR4。

*   **DP5: 内容生成与修订引擎 (Content Generation & Revision Engine)**
    *   职责：封装LLM的文本生成和编辑能力。它接收来自DP0的结构化指令和上下文，调用LLM生成或修改文档内容。
    *   主要实现 L1 FRs：FR5。

*   **DP6: 评审与评估引擎 (Review & Assessment Engine)**
    *   职责：封装LLM的文本分析和评估能力。它接收来自DP0的评审任务，对照标准执行内容评审，并生成结构化评审意见。
    *   主要实现 L1 FRs：FR6。

*   **DP7: 版本控制与变更服务 (Version Control & Change Service)**
    *   职责：提供与外部Git仓库交互的标准接口，并实现文档状态机和变更管理的核心逻辑。
    *   主要实现 L1 FRs：FR7。

*   **DP8: 用户交互接口 (User Interaction Interface)**
    *   职责：负责捕获所有用户输入（命令、决策、批注），将其解析为系统内部的标准化命令，并传递给DP0或其他相关模块。
    *   主要实现 L1 FRs：FR8。

#### **4. L1 设计矩阵**

基于重构后的FRs和DPs，我们构建了新的设计矩阵。此矩阵严格遵循公理设计的原则。

**耦合级别定义：**
*   **X (强耦合 / 实现关系):** DP是**唯一直接负责实现**FR核心功能的物理（或逻辑）组件。此关系**仅应出现在对角线上** `(FR_i, DP_i)`。
*   **O (弱耦合 / 依赖关系):** 非对角线关系，表示一个DP为了完成其任务，需要另一个DP提供的服务或数据。这种依赖通过稳定的、定义良好的接口来管理，不影响FR的独立性。
    *   **控制耦合 (O_c):** 一个DP（通常是协调器）调用另一个DP来执行任务。例如，DP0调用DP5。
    *   **数据耦合 (O_d):** 一个DP需要从另一个DP获取数据才能工作。例如，DP5需要从DP3获取知识。
    *   **公共耦合 (O_p):** 两个或多个DPs依赖于同一个公共数据源。例如，DP5和DP6都依赖于DP2提供的词汇表。

| FR / DP | DP0 (控制器) | DP1 (模板) | DP2 (词汇) | DP3 (知识) | DP4 (仲裁) | DP5 (内容) | DP6 (评审) | DP7 (版本) | DP8 (用户) |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **FR1: 模板管理** | | **X** | | | | | | | |
| **FR2: 词汇管理** | | | **X** | | | | | | |
| **FR3: 知识检索** | | | | **X** | | | | | |
| **FR4: 知识仲裁** | | | O_p | O_p | **X** | | | | |
| **FR5: 内容生成** | O_c | O_d | O_p | O_d | O_d | **X** | | | O_d |
| **FR6: 内容评审** | O_c | O_d | O_p | O_d | O_d | O_d | **X** | O_d | |
| **FR7: 版本管理** | O_c | | | | | O_d | O_d | **X** | O_d |
| **FR8: 用户交互** | O_c | | | | | | | | **X** |

**矩阵分析可视化 (Mermaid.js Syntax)**

```mermaid
graph TD
    subgraph 设计参数 (DPs)
        DP0[DP0: 工作流与状态控制器]
        DP1[DP1: 项目模板管理器]
        DP2[DP2: 项目词汇服务]
        DP3[DP3: 知识检索服务]
        DP4[DP4: 知识仲裁器]
        DP5[DP5: 内容生成与修订引擎]
        DP6[DP6: 评审与评估引擎]
        DP7[DP7: 版本控制与变更服务]
        DP8[DP8: 用户交互接口]
    end

    %% DP0作为协调器，通过控制耦合调用其他DP
    DP0 -- O_c (调用) --> DP5
    DP0 -- O_c (调用) --> DP6
    DP0 -- O_c (调用) --> DP7
    DP0 -- O_c (调用) --> DP8

    %% 数据和公共耦合
    DP1 -- O_d (提供配置) ---> DP5
    DP1 -- O_d (提供配置) ---> DP6
    
    DP2 -- O_p (提供词汇) ---> DP5
    DP2 -- O_p (提供词汇) ---> DP6
    DP2 -- O_p (提供词汇) ---> DP4

    DP3 -- O_d (提供知识) ---> DP5
    DP3 -- O_d (提供知识) ---> DP6
    DP3 -- O_p (提供知识) ---> DP4

    DP4 -- O_d (提供最终知识) ---> DP5
    DP4 -- O_d (提供最终知识) ---> DP6

    DP8 -- O_d (提供用户指令) ---> DP5
    DP8 -- O_d (提供用户决策) ---> DP7
    
    DP5 -- O_d (提供草稿) --> DP6
    DP6 -- O_d (提供意见) --> DP5
    DP5 -- O_d (提供文档) --> DP7
    DP6 -- O_d (提供意见) --> DP7

    %% 功能实现关系 (X) - 为清晰起见，此处不绘制，矩阵已明确
    %% FR1 --> DP1, FR2 --> DP2, etc.
```

#### **5. 公理一 (Independence Axiom) 分析**

**分析结论：新设计 (V1.1) 遵循独立公理。**

V1.1的设计通过对FRs和DPs的根本性重构，成功地解决并消除了V1.0版本中存在的严重耦合问题。原设计将“工作流编排”这一实现机制错误地定义为FR，导致了与所有其他DPs强耦合的“上帝模块”(旧DP6)。本设计通过以下方式维护了功能需求的独立性：

1.  **实现关系的对角化 (Diagonalization):** 新的设计矩阵呈现出一个清晰的对角线。每个功能需求FR_i都由且仅由一个设计参数DP_i直接实现（标记为'X'）。例如，FR5（起草与修订文档内容）的核心功能由DP5（内容生成与修订引擎）独立完成。这从根本上保证了功能需求的独立性。

2.  **分离“做什么”与“何时/如何做”:** 本设计的核心改进是引入了DP0（工作流与状态控制器）。DP0是一个纯粹的协调器，它不实现任何FR，而是通过定义良好的接口（控制耦合 `O_c`）来**调用**其他DPs。这实现了“关注点分离”：FRs/DPs（1到8）定义了系统**能做什么**，而DP0定义了**何时以及如何**将这些能力组织成一个完整的流程。这种架构模式消除了原设计中的过程性强耦合。

3.  **弱耦合的管理:** 矩阵中所有的非对角线元素均为弱耦合（'O'），并被明确分类。
    *   **控制耦合 (`O_c`):** DP0对DP5-DP8的调用关系是单向的、非侵入性的。DP5不知道也不关心自己是被DP0调用还是被测试脚本调用，只要输入合法即可。这通过接口隔离了依赖。
    *   **数据耦合 (`O_d`) 与公共耦合 (`O_p`):** 知识服务（DP1-DP4）为业务引擎（DP5, DP6）提供数据。这种依赖是自然的，并且通过稳定的服务接口进行管理。例如，对DP3内部检索算法的修改，只要其对外接口不变，就不会影响到DP5。这确保了实现细节的变更被封装在各自的DP内部。

4.  **消除了旧设计的缺陷：**
    *   **旧FR1/DP1被分解：** 原先臃肿的FR1/DP1被分解为四个独立的FR/DP对（FR1-DP1到FR4-DP4），每个都职责单一，易于独立开发、测试和维护。
    *   **旧FR6/DP6被废除和重构：** 旧的FR6被识别为非功能需求并移除。其对应的“上帝模块”DP6被一个纯粹的、解耦的协调器DP0所取代，彻底解决了系统的核心耦合问题。

综上所述，V1.1设计是一个解耦的、符合独立公理的设计。它为后续的L2层级分解提供了一个坚实、可靠的基础，避免了将耦合问题传递到更深的设计层级中。

#### **6. 公理二 (Information Axiom) 分析框架**

公理二：在所有满足独立公理的设计中，选择信息内容最少的设计。

本L1设计已满足公理一。信息公理的应用框架将用于指导后续层级的设计决策和评估潜在的L2设计备选方案。该框架严格遵循URD V1.6第6.4节的要求。

1.  **识别设计备选方案：** 在对L1 DPs（如DP5 内容生成引擎）进行L2分解时，可能会出现多种满足独立公理的内部设计方案。
2.  **定义评估标准和指标：** 严格遵循《项目模板》（URD V1.6 第3.3节）中定义的量化指标及其**可计算定义 (Computable Definition)**。示例指标包括：
    *   `接口复杂度`: 定义为“所有接口方法参数的总数”。
    *   `内部组件数量`: 定义为“L2层级新增的DPs数量”。
    *   `外部依赖数量`: 定义为“引入的未在项目知识库中定义的外部库或服务的数量”。
3.  **建立指标优先级或权重：** 严格遵循《项目模板》为上述指标设定的决策优先级或权重。
4.  **备选方案评估与决策：** 设计者在提出每个备选方案时，必须提供对上述指标的估算值。评审者将依据模板中定义的优先级或加权总分进行评估和推荐，并明确陈述决策依据。

此框架确保信息公理的应用是确定性的、可重复的，符合项目的工程化要求。

#### **7. 后续步骤**

此L1公理设计文档 (V1.1) 标志着系统设计已回归正轨。后续步骤如下：

1.  **L1设计的正式评审与批准：** 本文档将进入系统的“评审-修订”周期。
2.  **用户审计与L1设计冻结：** 评审员批准后，文档将提交用户进行最终审计。批准后，此文档将被系统标记为“已冻结”，作为下一层分解的基准。
3.  **启动L2分解：** 用户将根据“单一DP分解原则”选择一个已冻结的L1 DP（例如，`DP5: 内容生成与修订引擎`）启动L2设计。该DP所实现的FR（`FR5`）将作为L2子系统的顶层功能需求。
4.  **迭代与并行分解：** 对选定的L1 DP执行L2公理设计。由于L1 DPs之间已高度解耦，可以并行启动对多个L1 DPs（如DP5, DP6, DP7）的分解工作，从而加速整体设计进程。
5.  **生成和执行项目待办事项列表：** 随着各层级设计文档被冻结，系统将分析所有已批准的设计，生成“项目待办事项列表”，并逐项启动接口规范等后续文档的生成任务。
6.  **管理变更：** 在整个过程中，对任何已冻结文档的修改都将严格遵循URD V1.6中定义的变更管理流程。

---
Gemini 2.5 Pro 0605 writer